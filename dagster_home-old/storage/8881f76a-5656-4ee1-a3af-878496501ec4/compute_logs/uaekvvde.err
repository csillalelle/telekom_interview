[32m2025-07-03 01:38:42 +0000[0m - dagster - [34mDEBUG[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - 716673 - LOGS_CAPTURED - Started capturing logs in process (pid: 716673).
[32m2025-07-03 01:38:42 +0000[0m - dagster - [34mDEBUG[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - 716673 - tune - STEP_START - Started execution of step "tune".
[32m2025-07-03 01:38:42 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Starting model tuning process
[32m2025-07-03 01:38:42 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Loading processed features and labels from database
/workspaces/data-scientist-at-magenta/src/code_location_interview/code_location_interview/assets/training.py:118: DataOrientationWarning: Row orientation inferred during DataFrame construction. Explicitly specify the orientation by passing `orient="row"` to silence this warning.
  features_df = pl.DataFrame(features_result, schema=column_names).drop('rn')
[32m2025-07-03 01:38:42 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Loaded 22821 feature records
/workspaces/data-scientist-at-magenta/src/code_location_interview/code_location_interview/assets/training.py:137: DataOrientationWarning: Row orientation inferred during DataFrame construction. Explicitly specify the orientation by passing `orient="row"` to silence this warning.
  labels_df = pl.DataFrame(labels_result, schema=labels_column_names)
[32m2025-07-03 01:38:42 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - All columns in features_df: ['rating_account_id', 'customer_id', 'age', 'contract_lifetime_days', 'remaining_binding_days', 'has_special_offer', 'is_magenta1_customer', 'available_gb', 'gross_mrc', 'has_done_upselling', 'completion_rate', 'is_bounded', 'is_huawei', 'is_oneplus', 'is_samsung', 'is_xiaomi', 'is_iphone', 'n_contracts_per_customer', 'avg_monthly_usage_gb', 'total_usage_gb', 'max_monthly_usage_gb', 'months_with_roaming', 'ever_used_roaming', 'active_usage_months', 'months_with_no_delta_1mo_change', 'avg_delta_2mo', 'delta_2mo_volatility', 'max_delta_2mo_increase', 'max_delta_2mo_decrease', 'months_with_delta_2mo_increase', 'months_with_no_delta_2mo_change', 'months_with_delta_3mo_increase', 'months_with_no_delta_3mo_change', 'last_1_delta_1mo', 'last_2_delta_1mo', 'last_3_delta_1mo', 'last_1_delta_2mo', 'last_2_delta_2mo', 'last_1_delta_3mo', 'n_rechnungsanfragen', 'n_produkte_services_tarifdetails', 'n_prolongation', 'n_produkte_services_tarifwechsel', 'days_since_last_rechnungsanfragen', 'days_since_last_produkte_services_tarifdetails', 'days_since_last_prolongation', 'days_since_last_produkte_services_tarifwechsel', 'times_in_p1', 'times_in_p2', 'times_in_p3', 'times_in_p4', 'times_in_p5', 'created_at']
[32m2025-07-03 01:38:42 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Excluded columns: ['rating_account_id', 'customer_id', 'has_done_upselling', 'created_at']
[32m2025-07-03 01:38:42 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Feature columns (49): ['age', 'contract_lifetime_days', 'remaining_binding_days', 'has_special_offer', 'is_magenta1_customer', 'available_gb', 'gross_mrc', 'completion_rate', 'is_bounded', 'is_huawei', 'is_oneplus', 'is_samsung', 'is_xiaomi', 'is_iphone', 'n_contracts_per_customer', 'avg_monthly_usage_gb', 'total_usage_gb', 'max_monthly_usage_gb', 'months_with_roaming', 'ever_used_roaming', 'active_usage_months', 'months_with_no_delta_1mo_change', 'avg_delta_2mo', 'delta_2mo_volatility', 'max_delta_2mo_increase', 'max_delta_2mo_decrease', 'months_with_delta_2mo_increase', 'months_with_no_delta_2mo_change', 'months_with_delta_3mo_increase', 'months_with_no_delta_3mo_change', 'last_1_delta_1mo', 'last_2_delta_1mo', 'last_3_delta_1mo', 'last_1_delta_2mo', 'last_2_delta_2mo', 'last_1_delta_3mo', 'n_rechnungsanfragen', 'n_produkte_services_tarifdetails', 'n_prolongation', 'n_produkte_services_tarifwechsel', 'days_since_last_rechnungsanfragen', 'days_since_last_produkte_services_tarifdetails', 'days_since_last_prolongation', 'days_since_last_produkte_services_tarifwechsel', 'times_in_p1', 'times_in_p2', 'times_in_p3', 'times_in_p4', 'times_in_p5']
[32m2025-07-03 01:38:42 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Using 49 features for training
[32m2025-07-03 01:38:42 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Dataset shape: X=(22821, 49), y=(22821,)
[32m2025-07-03 01:38:42 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Target distribution: [21216  1605]
[32m2025-07-03 01:38:42 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Train set: (18256, 49), Test set: (4565, 49)
[32m2025-07-03 01:38:42 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Starting hyperparameter tuning with Optuna
[32m[I 2025-07-03 01:38:43,203][0m A new study created in RDB with name: random_forest_optimization_retrain_20250703_013842[0m
[32m[I 2025-07-03 01:38:55,550][0m Trial 0 finished with value: 0.15077484772347177 and parameters: {'n_estimators': 845, 'max_depth': 5, 'min_samples_split': 5, 'min_samples_leaf': 1, 'min_weight_fraction_leaf': 0.0798241708495504, 'max_features': 'log2', 'max_samples': 0.17430210225837334, 'max_leaf_nodes': 936, 'class_weight': 'balanced'}. Best is trial 0 with value: 0.15077484772347177.[0m
[32m[I 2025-07-03 01:39:08,544][0m Trial 1 finished with value: 0.0 and parameters: {'n_estimators': 853, 'max_depth': 17, 'min_samples_split': 10, 'min_samples_leaf': 3, 'min_weight_fraction_leaf': 0.38712498974820647, 'max_features': 'sqrt', 'max_samples': 0.8172508031965067, 'max_leaf_nodes': 86, 'class_weight': None}. Best is trial 0 with value: 0.15077484772347177.[0m
[32m[I 2025-07-03 01:39:13,088][0m Trial 2 finished with value: 0.1502187934864986 and parameters: {'n_estimators': 171, 'max_depth': 20, 'min_samples_split': 15, 'min_samples_leaf': 3, 'min_weight_fraction_leaf': 0.424004828137806, 'max_features': 'log2', 'max_samples': 0.9571845622021468, 'max_leaf_nodes': 214, 'class_weight': 'balanced_subsample'}. Best is trial 0 with value: 0.15077484772347177.[0m
[32m[I 2025-07-03 01:39:38,885][0m Trial 3 finished with value: 0.1564484630451572 and parameters: {'n_estimators': 646, 'max_depth': 11, 'min_samples_split': 18, 'min_samples_leaf': 1, 'min_weight_fraction_leaf': 0.04926916524036562, 'max_features': 'sqrt', 'max_samples': 0.656333499081504, 'max_leaf_nodes': 982, 'class_weight': 'balanced_subsample'}. Best is trial 3 with value: 0.1564484630451572.[0m
[32m[I 2025-07-03 01:39:42,908][0m Trial 4 finished with value: 0.0 and parameters: {'n_estimators': 181, 'max_depth': 9, 'min_samples_split': 11, 'min_samples_leaf': 8, 'min_weight_fraction_leaf': 0.13902536442432478, 'max_features': 'log2', 'max_samples': 0.7533628025167147, 'max_leaf_nodes': 55, 'class_weight': None}. Best is trial 3 with value: 0.1564484630451572.[0m
[32m[I 2025-07-03 01:39:47,944][0m Trial 5 finished with value: 0.15286641012200436 and parameters: {'n_estimators': 408, 'max_depth': 5, 'min_samples_split': 19, 'min_samples_leaf': 1, 'min_weight_fraction_leaf': 0.41015126221656006, 'max_features': 'log2', 'max_samples': 0.3808095315131378, 'max_leaf_nodes': 396, 'class_weight': 'balanced'}. Best is trial 3 with value: 0.1564484630451572.[0m
[32m[I 2025-07-03 01:39:57,477][0m Trial 6 finished with value: 0.15386129440754245 and parameters: {'n_estimators': 340, 'max_depth': 14, 'min_samples_split': 18, 'min_samples_leaf': 1, 'min_weight_fraction_leaf': 0.07588161885193329, 'max_features': 'sqrt', 'max_samples': 0.6467567923608941, 'max_leaf_nodes': 36, 'class_weight': 'balanced'}. Best is trial 3 with value: 0.1564484630451572.[0m
[32m[I 2025-07-03 01:40:03,172][0m Trial 7 finished with value: 0.0 and parameters: {'n_estimators': 255, 'max_depth': 3, 'min_samples_split': 15, 'min_samples_leaf': 2, 'min_weight_fraction_leaf': 0.022535772050909786, 'max_features': 'log2', 'max_samples': 0.7309100188362232, 'max_leaf_nodes': 643, 'class_weight': None}. Best is trial 3 with value: 0.1564484630451572.[0m
[32m[I 2025-07-03 01:40:09,093][0m Trial 8 finished with value: 0.1554834733473237 and parameters: {'n_estimators': 395, 'max_depth': 7, 'min_samples_split': 15, 'min_samples_leaf': 8, 'min_weight_fraction_leaf': 0.23028867562978284, 'max_features': 'sqrt', 'max_samples': 0.30549277277521514, 'max_leaf_nodes': 348, 'class_weight': 'balanced'}. Best is trial 3 with value: 0.1564484630451572.[0m
[32m[I 2025-07-03 01:40:27,071][0m Trial 9 finished with value: 0.15241327685879175 and parameters: {'n_estimators': 754, 'max_depth': 19, 'min_samples_split': 15, 'min_samples_leaf': 9, 'min_weight_fraction_leaf': 0.061941488739628736, 'max_features': 'log2', 'max_samples': 0.5812698438305463, 'max_leaf_nodes': 595, 'class_weight': 'balanced'}. Best is trial 3 with value: 0.1564484630451572.[0m
[32m2025-07-03 01:40:27 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Hyperparameter tuning completed with 10 trials
[32m2025-07-03 01:40:27 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Best CV score: 0.1564
[32m2025-07-03 01:40:27 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Best parameters: {'n_estimators': 646, 'max_depth': 11, 'min_samples_split': 18, 'min_samples_leaf': 1, 'min_weight_fraction_leaf': 0.04926916524036562, 'max_features': 'sqrt', 'max_samples': 0.656333499081504, 'max_leaf_nodes': 982, 'class_weight': 'balanced_subsample'}
[32m2025-07-03 01:40:27 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Training final model with best parameters
[32m2025-07-03 01:40:33 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Model training completed successfully
[32m2025-07-03 01:40:33 +0000[0m - dagster - [34mINFO[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Tuning completed - CV F1 Score: 0.1564
[32m2025-07-03 01:40:33 +0000[0m - dagster - [34mDEBUG[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - 716673 - tune - STEP_OUTPUT - Yielded output "result" of type "Any". (Type check passed).
[32m2025-07-03 01:40:33 +0000[0m - dagster - [34mDEBUG[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - tune - Writing file at: /workspaces/data-scientist-at-magenta/dagster_home/storage/tune using PickledObjectFilesystemIOManager...
[32m2025-07-03 01:40:33 +0000[0m - dagster - [34mDEBUG[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - 716673 - tune - ASSET_MATERIALIZATION - Materialized value tune.
[32m2025-07-03 01:40:33 +0000[0m - dagster - [34mDEBUG[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - 716673 - tune - HANDLED_OUTPUT - Handled output "result" using IO manager "io_manager"
[32m2025-07-03 01:40:33 +0000[0m - dagster - [34mDEBUG[0m - training_pipeline_job - 8881f76a-5656-4ee1-a3af-878496501ec4 - 716673 - tune - STEP_SUCCESS - Finished execution of step "tune" in 1m51s.
